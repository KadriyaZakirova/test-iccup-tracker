var ValidateUpd=new Class({getOptions:function(){return{validateOnBlur:true,errorClass:'error',errorMsgClass:'errorMessage',dateFormat:'dd/MM/yy',onFail:Class.empty,onSuccess:false,showErrorsInline:true,label:localeLang.pleaseWait};},initialize:function(form,options){this.options={};this.options.validateOnBlur=true;this.options.errorClass='error';this.options.errorMsgClass='errorMessage';this.options.dateFormat='dd/MM/yy';this.options.onFail=Class.empty;this.options.onSuccess=false;this.options.showErrorsInline=true;this.options.label=localeLang.pleaseWait;this.form=$(form);this.elements=this.form.getElements('.required');this.list=[];this.elements.each(function(el,i){if(this.options.validateOnBlur){el.addEvent('blur',this.validate.bind(this,el));}}.bind(this));$('reg-btn').removeEvents('click');this.form.addEvent('submit',function(e){var event=new Event(e);this.doSubmit=true;this.elements.each(function(el,i){if(!this.validate(el)){event.stop();this.doSubmit=false
this.list.include(el);}else{this.list.empty();}}.bind(this));if(this.doSubmit){if(this.options.onSuccess){event.stop();this.options.onSuccess(this.form);}else{this.form.getElement('input[type=submit]').setProperty('value',this.options.label);}}else{this.getList();}}.bind(this));},getList:function(){var list=new Element('ul');this.list.each(function(el,i){if(el.title!=''){var li=new Element('li').injectInside(list);new Element('label').setProperty('for',el.id).set('html',el.title).injectInside(li);}});return list;},validate:function(el){this.valid=true;this.clearMsg(el);switch(el.type){case 'text':case 'textarea':case 'select-one':if(el.value!=''){if(el.hasClass('email')){var regEmail=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/;if(el.value.toUpperCase().match(regEmail)){this.valid=true;}else{this.valid=false;}}
if(el.hasClass('number')){var regNum=/[-+]?[0-9]*\.?[0-9]+/;if(el.value.match(regNum)){if(el.value==0){this.valid=false;}
else this.valid=true;}else{this.valid=false;}}
if(el.hasClass('code')){var regPC=/^([A-Za-z0-9]{5})$/
if(el.value.match(regPC)){this.valid=true;}else{this.valid=false;}}
if(el.hasClass('login')){var regPC=/^([\(\)\.\_\-a-zA-Z0-9\[\]]{2,14})$/
var tokenValue=$('token').get('value');if(this.loginTrue&&(this.loginTrue==el.value)){this.valid=true;}else if(this.loginFalse&&(this.loginFalse==el.value)){this.valid=false;}else if(el.value.match(regPC)){var req2=new Request.JSON({async:false,url:'/json/validatelog/',onSuccess:function(responseText){}}).send('login='+el.value+'&token='+tokenValue);if(req2.response.json.mes=='ok'){this.loginTrue=el.value;this.loginFalse=false;if(el.getNext()){el.getNext().addClass('hide');}
el.getParent('.input').getChildren('h3').set('text',localeLang.validText);this.valid=true;}else{this.loginFalse=el.value;this.loginTrue=false;el.getParent('.input').getChildren('h3').set('text',localeLang.validLogin);this.valid=false;}}else{this.valid=false;}}
if(el.hasClass('date')){var d=Date.parseExact(el.value,this.options.dateFormat);if(d!=null){this.valid=true;}else{this.valid=false;this.setMsg(el,localeLang.pleaseEnterValidDate+this.options.dateFormat.toLowerCase());}}
if(!this.valid){this.setMsg(el);}}else{this.valid=false;this.setMsg(el);}
break;case 'checkbox':if(!el.checked){this.valid=false;this.setMsg(el);}else{this.valid=true;}
break;case 'password':if(el.value==''){this.valid=false;}else{if(el.value.length<6){this.valid=false;}else{if(el.hasClass('confirm')){if(el.value==this.form.field8.value){this.valid=true;}
else{this.valid=false;}}else this.valid=true;}}
if(!this.valid){this.setMsg(el);}
break;case 'radio':var rad=$A(this.form[el.name]);var ok=false;rad.each(function(e,i){if(e.checked){ok=true;}});if(!ok){this.valid=false;this.setMsg(rad.getLast(),localeLang.pleaseSelectOption);}else{this.valid=true;this.clearMsg(rad.getLast());}
break;}
return this.valid;},setMsg:function(el,msg){el.addClass('attention');if(this.attentionCreated){this.attentionCreated.removeClass('hide');}else{this.attention=new Element('span',{'class':'attention-img'});this.attention.inject(el,'after');}
var hz=el;if(hz){hz.addClass('error-message');}},clearMsg:function(el){el.removeClass('error-message');}});var TicketAct=new Class({initialize:function(){this.tActions=$('tActions');this.tActionsList=$('tActionsList');this.tLink=$$('.tLink')[0];$$('.ulActions li:nth-child(last)').setStyle('border','none');if(this.tLink){this.tLink.addEvent('click',this.viewActions.bind(this));}
var that=this;$$('.ulActions li a').each(function(el){el.addEvent('click',this.ticketAction.bind(this))}.bind(this));},ticketAction:function(e){e.stop();this.href=$(e.target).closest('a');this.id=this.href.get('rel');var I="id="+this.id;this.action=this.href.get('class');if(this.action=="delete"){this.half="/bugtracker/ajax/deleteBug/";}else{this.half="/bugtracker/ajax/changeBugStatus/";}
this.li=this.href.getParent('li');var that=this;new Request.JSON({method:'post',onSuccess:function(K){if(K.error){that.li.set('text','ошибка')}
else{that.li.set('text','успех!')}
that.closeAct();},url:this.half+this.action}).send(I);},viewActions:function(e){e.stop();this.closeActions=new Element('div',{id:'closeActions'});this.bodyTicket=$$('.body-ticket')[0];this.closeActions.inject(this.bodyTicket,'before');this.closeActions.addEvent('click',this.closeAct.bind(this));if(this.tActionsList.get('actiontype')=="close"){this.tLink.addClass('tSelected');this.tActionsList.fade('hide');this.tActionsList.removeClass('hide');this.tActionsList.fade('in');this.tActionsList.set('actiontype','open');}
else{this.closeAct();}},closeAct:function(){this.tLink.removeClass('tSelected');this.tActionsList.fade('out');(function(){this.tActionsList.addClass('hide');}).delay(400,this)
this.tActionsList.set('actiontype','close');$('closeActions').destroy();}});window.addEvent('domready',function(){if($('tActions'))new TicketAct();$$('.blog-rate').each((function(el){el.addEvent('click',function(e){e.stop();this.el=$(e.target);this.elems=this.el.getParent('.poll').getElements('.blog-rate');this.poll=this.el.getParent('.poll');this.num=this.poll.getChildren('.poll-score');el=''+this.el+'';el1=el.replace(/([^ ]+)rateBug\/([0-9]+)\/([-1]+).html/gi,'$2');el2=el.replace(/([^ ]+)rateBug\/([0-9]+)\/([-1]+).html/gi,'$3');var I="id="+el1+"&mark="+el2;var that=this;new Request.JSON({method:'post',link:'chain',onSuccess:function(K){that.elems.each(function(el){el.destroy();})
var newEl=new Element('span',{'class':'vote-top'});var newEl2=new Element('span',{'class':'vote-bottom'});newEl.inject(that.poll);newEl2.inject(that.poll);function message(msg){var elInfo=new Element('div',{'class':'vote-info','html':msg});elInfo.inject(that.poll);elInfo.set('tween',{duration:2500}).fade('out');}
if(K.error){message(K.error);}
else{message('Спасибо, голос учтен');that.num.set('text',K.total)}},url:'/json/rateBug/'}).send(I);return false;});}));const typesTabs=$$('.tracker-types__tab');if(typesTabs[0]){const queryString=window.location.search;const urlParams=new URLSearchParams(queryString);const urlParamsType=urlParams.get('type')?urlParams.get('type'):null;const typesIndexes=[null,'dota','launcher'];const currentType=typesIndexes.find(ind=>ind===urlParamsType);const currentTabIndex=currentType?typesIndexes.indexOf(currentType):0;$$('.tracker-types__tab._active').removeClass('_active');typesTabs[currentTabIndex].addClass('_active');}});